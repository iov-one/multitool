{"version":3,"sources":["ConditionalError.tsx","settings.ts","Transaction.tsx","util/json.ts","util/amounts.ts","util/connection.ts","util/errors.ts","util/ledger.ts","util/base64url.ts","util/arrays.ts","util/checksummed.ts","util/signatures.ts","util/links.ts","Create.tsx","Sign.tsx","Start.tsx","SignaturesList.tsx","util/text.ts","Status.tsx","index.tsx"],"names":["ConditionalError","error","Alert","variant","hidden","chains","Map","id","tokenTicker","fee","quantity","fractionalDigits","nodeUrl","networkType","Transaction","transaction","json","document","JSON","parse","stringify","prettyPrintJson","TransactionEncoder","toJson","amountToString","amount","Decimal","fromAtomics","toString","getConnector","chainId","a","async","chain","get","Error","bnsConnector","createBnsConnector","getNonce","pubkey","connector","establishConnection","bnsConnection","nonce","disconnect","getErrorMessage","message","addressIndex","getPubkeyFromLedger","requiredNetworkType","TransportWebUSB","create","transport","app","IovLedgerApp","getVersion","versionResponse","isIovLedgerAppVersion","errorMessage","responseNetwork","testMode","getAddress","response","isIovLedgerAppAddress","close","createSignature","signer","bnsCodec","bytesToSign","bytes","sign","signatureResponse","isIovLedgerAppSignature","signature","base64urlEncode","data","Encoding","toBase64","replace","base64urlDecode","encoded","fromBase64","arrayEquals","b","length","every","byte","index","checksumLength","makeChecksum","Sha256","digest","slice","decodeChecksummed","decoder","decoded","expectedChecksum","raw","isUnsignedMultisignatureSendTransaction","isNonNullObject","isUnsignedTransaction","isSendTransaction","isMultisignatureTx","toPrintableSignature","fromPrintableSignature","input","fullSignature","fromJson","isFullSignature","verifySignature","prehashType","PrehashType","Sha512","prehash","Ed25519","valid","fromUtf8","toUtf8","toLinkEncoded","encoder","checksum","Uint8Array","encodeChecksummed","toPrintableSignedTransaction","signedFromLinkEncoded","signedTransaction","primarySignature","otherSignatures","Array","isArray","some","sig","isSignedMultisignatureSendTransaction","makeSigningLink","unsignedTransaction","absolute","encodedTransaction","prefix","window","location","href","split","emptyState","creatorHex","formMultisigContractId","formRecipient","formQuantity","formMemo","encodingError","signing","Create","props","state","this","lastQueriedMultisigContractId","setState","contractInfo","undefined","contractId","address","multisignatureIdToAddress","getAccount","account","balance","getBalance","Uint64","fromString","toNumber","then","catch","console","multisigId","sender","expectedPrefix","startsWith","tx","kind","creator","algo","Algorithm","fromHex","fromUserInput","atomics","recipient","memo","tokens","multisig","equal","Container","statusUrl","to","push","Row","Col","className","htmlFor","value","onChange","e","handleFormChange","from","keys","map","onClick","event","preventDefault","reloadCreatorFromLedger","clearCreator","type","placeholder","disabled","getPubkeyError","signAndContinue","signingError","join","field","newValue","target","pubkeyHex","toHex","log","info","unsigned","createSigned","signed","makeStatusLink","React","Component","Sign","localSignature","matches","match","unsignedFromLinkEncoded","warn","globalError","rows","readOnly","original","pubkeyResponse","Start","Signature","noneStatus","identityToAddress","key","str","maxOutLen","frontLen","Math","ceil","tailLen","floor","ellideMiddle","received","expected","SignaturesList","interval","nonceStatuses","signatures","_","runCheck","Promise","all","latestNonce","statuses","setTimeout","setInterval","clearTimeout","Status","posting","addSignature","addSignatureError","postSuccess","postToChain","postError","signatureInput","prompt","newSignature","find","filter","firstSignature","makeSignedTransaction","postTx","bytesToPost","blockInfo","waitFor","isBlockInfoPending","isBlockInfoFailed","transactionId","postSignedTransaction","ReactDOM","render","exact","path","component","getElementById"],"mappings":"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","file":"static/js/main.f65fdef0.chunk.js","sourcesContent":["import React from \"react\";\nimport Alert from \"react-bootstrap/Alert\";\n\ninterface Props {\n  readonly error: string | undefined;\n}\n\nconst ConditionalError = ({ error }: Props): JSX.Element => {\n  return (\n    <Alert variant=\"danger\" hidden={!error}>\n      {error}\n    </Alert>\n  );\n};\n\nexport default ConditionalError;\n","import { Amount, ChainId, TokenTicker } from \"@iov/bcp\";\n\nexport interface ChainInfo {\n  readonly id: ChainId;\n  readonly tokenTicker: TokenTicker;\n  readonly fee: Amount;\n  readonly nodeUrl: string;\n  readonly networkType: \"testnet\" | \"mainnet\";\n}\n\ntype Chain = [string, ChainInfo];\n\nconst devnet: Chain = [\n  \"local-iov-devnet\",\n  {\n    id: \"local-iov-devnet\" as ChainId,\n    tokenTicker: \"CASH\" as TokenTicker,\n    fee: {\n      quantity: \"100000000\",\n      fractionalDigits: 9,\n      tokenTicker: \"CASH\" as TokenTicker,\n    },\n    nodeUrl: \"ws://localhost:23456/\",\n    networkType: \"testnet\",\n  },\n];\n\nconst babynet: Chain = [\n  \"iov-babynet\",\n  {\n    id: \"iov-babynet\" as ChainId,\n    tokenTicker: \"IOV\" as TokenTicker,\n    fee: {\n      quantity: \"500000000\",\n      fractionalDigits: 9,\n      tokenTicker: \"IOV\" as TokenTicker,\n    },\n    nodeUrl: \"wss://rpc-private-a-vip-babynet.iov.one\",\n    networkType: \"testnet\",\n  },\n];\n\nconst clapnet: Chain = [\n  \"iov-clapnet\",\n  {\n    id: \"iov-clapnet\" as ChainId,\n    tokenTicker: \"IOV\" as TokenTicker,\n    fee: {\n      quantity: \"500000000\",\n      fractionalDigits: 9,\n      tokenTicker: \"IOV\" as TokenTicker,\n    },\n    nodeUrl: \"wss://rpc-private-a-vip2-clapnet.iov.one\",\n    networkType: \"testnet\",\n  },\n];\n\nconst mainnet: Chain = [\n  \"iov-mainnet\",\n  {\n    id: \"iov-mainnet\" as ChainId,\n    tokenTicker: \"IOV\" as TokenTicker,\n    fee: {\n      quantity: \"500000000\",\n      fractionalDigits: 9,\n      tokenTicker: \"IOV\" as TokenTicker,\n    },\n    nodeUrl: \"wss://rpc-private-a-vip-mainnet.iov.one\",\n    networkType: \"mainnet\",\n  },\n];\n\nexport const chains = new Map<string, ChainInfo>([devnet, babynet, clapnet, mainnet]);\n","import { SendTransaction, UnsignedTransaction } from \"@iov/bcp\";\nimport { MultisignatureTx } from \"@iov/bns\";\nimport { TransactionEncoder } from \"@iov/encoding\";\nimport React from \"react\";\n\nimport { prettyPrintJson } from \"./util/json\";\n\ninterface TransactionProps {\n  readonly transaction: UnsignedTransaction & SendTransaction & MultisignatureTx;\n}\n\nconst Transaction = ({ transaction }: TransactionProps): JSX.Element => {\n  return <pre>{prettyPrintJson(TransactionEncoder.toJson(transaction))}</pre>;\n};\n\nexport default Transaction;\n","import { JsonCompatibleValue } from \"@iov/encoding\";\n\nexport function prettyPrintJson(json: string | JsonCompatibleValue): string {\n  const document = typeof json === \"string\" ? JSON.parse(json) : json;\n  return JSON.stringify(document, null, 2);\n}\n","import { Amount } from \"@iov/bcp\";\nimport { Decimal } from \"@iov/encoding\";\n\n// This produces a human readable format of the amount, value and token ticker\nexport function amountToString(amount: Amount): string {\n  const { quantity, fractionalDigits, tokenTicker } = amount;\n  return `${Decimal.fromAtomics(quantity, fractionalDigits).toString()} ${tokenTicker}`;\n}\n","import {\n  Address,\n  Amount,\n  ChainConnector,\n  ChainId,\n  isBlockInfoFailed,\n  isBlockInfoPending,\n  Nonce,\n  PubkeyBundle,\n  SendTransaction,\n  SignedTransaction,\n  TransactionId,\n  WithCreator,\n} from \"@iov/bcp\";\nimport { bnsCodec, createBnsConnector, multisignatureIdToAddress, MultisignatureTx } from \"@iov/bns\";\n\nimport { chains } from \"../settings\";\n\nexport async function getConnector(chainId: ChainId): Promise<ChainConnector> {\n  const chain = chains.get(chainId);\n  if (!chain) throw new Error(\"Chain not found\");\n\n  const bnsConnector = createBnsConnector(chain.nodeUrl, chainId as ChainId);\n  return bnsConnector;\n}\n\nexport async function getNonce(chainId: ChainId, pubkey: PubkeyBundle): Promise<Nonce> {\n  const connector = await getConnector(chainId);\n  const bnsConnection = await connector.establishConnection();\n  const nonce = await bnsConnection.getNonce({ pubkey: pubkey });\n  bnsConnection.disconnect();\n  return nonce;\n}\n\nexport async function getBalance(\n  chainId: ChainId,\n  contractId: number,\n): Promise<{ readonly address: Address; readonly balance: readonly Amount[] | undefined }> {\n  const address = multisignatureIdToAddress(chainId, contractId);\n  const connector = await getConnector(chainId);\n  const bnsConnection = await connector.establishConnection();\n  const account = await bnsConnection.getAccount({ address: address });\n  bnsConnection.disconnect();\n  return {\n    address: address,\n    balance: account ? account.balance : undefined,\n  };\n}\n\nexport async function postSignedTransaction(\n  signed: SignedTransaction<SendTransaction & MultisignatureTx & WithCreator>,\n): Promise<TransactionId> {\n  const connector = await getConnector(signed.transaction.creator.chainId);\n  const bnsConnection = await connector.establishConnection();\n\n  const response = await bnsConnection.postTx(bnsCodec.bytesToPost(signed));\n  const blockInfo = await response.blockInfo.waitFor(info => !isBlockInfoPending(info));\n  if (isBlockInfoPending(blockInfo)) throw new Error(\"Block info still pending. This is a bug\");\n\n  if (isBlockInfoFailed(blockInfo)) {\n    throw new Error(`Error posting transaction: ${blockInfo.message}`);\n  }\n\n  return response.transactionId;\n}\n","export function getErrorMessage(error: unknown): string {\n  return error instanceof Error ? error.message : `${error}`;\n}\n","import {\n  FullSignature,\n  Identity,\n  PubkeyBytes,\n  SendTransaction,\n  SignatureBytes,\n  SignedTransaction,\n  UnsignedTransaction,\n  WithCreator,\n} from \"@iov/bcp\";\nimport { bnsCodec, MultisignatureTx } from \"@iov/bns\";\nimport {\n  IovLedgerApp,\n  isIovLedgerAppAddress,\n  isIovLedgerAppSignature,\n  isIovLedgerAppVersion,\n} from \"@iov/ledger-bns\";\nimport TransportWebUSB from \"@ledgerhq/hw-transport-webusb\";\n\nimport { getNonce } from \"./connection\";\n\nconst addressIndex = 0;\n\nexport interface PubkeyResponse {\n  readonly pubkey: PubkeyBytes;\n}\n\nexport async function getPubkeyFromLedger(\n  requiredNetworkType: \"testnet\" | \"mainnet\",\n): Promise<PubkeyResponse> {\n  const transport = await TransportWebUSB.create(1000);\n\n  try {\n    const app = new IovLedgerApp(transport);\n    const versionResponse = await app.getVersion();\n    if (!isIovLedgerAppVersion(versionResponse)) throw new Error(versionResponse.errorMessage);\n    const responseNetwork = versionResponse.testMode ? \"testnet\" : \"mainnet\";\n    if (requiredNetworkType !== responseNetwork) {\n      throw new Error(\n        `Pubkey for ${requiredNetworkType} required but got response from the ${responseNetwork} app`,\n      );\n    }\n\n    const response = await app.getAddress(addressIndex);\n    if (!isIovLedgerAppAddress(response)) throw new Error(response.errorMessage);\n\n    return {\n      pubkey: response.pubkey as PubkeyBytes,\n    };\n  } finally {\n    await transport.close();\n  }\n}\n\nexport async function createSignature(\n  transaction: UnsignedTransaction,\n  signer: Identity,\n): Promise<FullSignature> {\n  const nonce = await getNonce(signer.chainId, signer.pubkey);\n  const { bytes } = bnsCodec.bytesToSign(transaction, nonce);\n  const requiredNetworkType = signer.chainId === \"iov-mainnet\" ? \"mainnet\" : \"testnet\";\n\n  const transport = await TransportWebUSB.create(5000);\n\n  try {\n    const app = new IovLedgerApp(transport);\n    const versionResponse = await app.getVersion();\n    if (!isIovLedgerAppVersion(versionResponse)) throw new Error(versionResponse.errorMessage);\n    const responseNetwork = versionResponse.testMode ? \"testnet\" : \"mainnet\";\n    if (requiredNetworkType !== responseNetwork) {\n      throw new Error(\n        `Pubkey for ${requiredNetworkType} required but got response from the ${responseNetwork} app`,\n      );\n    }\n\n    const signatureResponse = await app.sign(addressIndex, bytes);\n    if (!isIovLedgerAppSignature(signatureResponse)) throw new Error(signatureResponse.errorMessage);\n\n    return {\n      pubkey: signer.pubkey,\n      nonce: nonce,\n      signature: signatureResponse.signature as SignatureBytes,\n    };\n  } finally {\n    await transport.close();\n  }\n}\n\nexport async function createSigned(\n  unsigned: UnsignedTransaction & SendTransaction & MultisignatureTx,\n): Promise<SignedTransaction<SendTransaction & MultisignatureTx & WithCreator>> {\n  const signature = await createSignature(unsigned, unsigned.creator);\n  return {\n    transaction: unsigned,\n    primarySignature: signature,\n    otherSignatures: [],\n  };\n}\n","import { Encoding } from \"@iov/encoding\";\n\nexport function base64urlEncode(data: Uint8Array): string {\n  return Encoding.toBase64(data)\n    .replace(\"+\", \"-\")\n    .replace(\"/\", \"_\");\n}\n\nexport function base64urlDecode(encoded: string): Uint8Array {\n  return Encoding.fromBase64(encoded.replace(\"-\", \"+\").replace(\"_\", \"/\"));\n}\n","export function arrayEquals(a: Uint8Array, b: Uint8Array): boolean {\n  return a.length === b.length && a.every((byte, index) => byte === b[index]);\n}\n","import { Sha256 } from \"@iov/crypto\";\n\nimport { arrayEquals } from \"./arrays\";\n\nexport type Encoder = (data: Uint8Array) => string;\nexport type Decoder = (encoded: string) => Uint8Array;\n\nconst checksumLength = 4; // bytes\n\nfunction makeChecksum(data: Uint8Array): Uint8Array {\n  return new Sha256(data).digest().slice(0, checksumLength);\n}\n\nexport function encodeChecksummed(data: Uint8Array, encoder: Encoder): string {\n  const checksum = makeChecksum(data);\n  return encoder(new Uint8Array([...checksum, ...data]));\n}\n\nexport function decodeChecksummed(encoded: string, decoder: Decoder): Uint8Array {\n  const decoded = decoder(encoded);\n  const expectedChecksum = decoded.slice(0, checksumLength);\n  const raw = decoded.slice(checksumLength);\n\n  if (!arrayEquals(expectedChecksum, makeChecksum(raw))) throw new Error(\"Checksum mismatch\");\n\n  return raw;\n}\n","import {\n  FullSignature,\n  isFullSignature,\n  isSendTransaction,\n  isUnsignedTransaction,\n  PrehashType,\n  SendTransaction,\n  SignedTransaction,\n  UnsignedTransaction,\n  WithCreator,\n} from \"@iov/bcp\";\nimport { bnsCodec, isMultisignatureTx, MultisignatureTx } from \"@iov/bns\";\nimport { Ed25519, Sha512 } from \"@iov/crypto\";\nimport { isNonNullObject, TransactionEncoder } from \"@iov/encoding\";\n\nexport function isUnsignedMultisignatureSendTransaction(\n  data: unknown,\n): data is SendTransaction & MultisignatureTx & WithCreator {\n  if (!isNonNullObject(data)) return false;\n\n  const transaction = data as SignedTransaction;\n  if (!isUnsignedTransaction(transaction)) return false;\n  if (!isSendTransaction(transaction)) return false;\n  if (!isMultisignatureTx(transaction)) return false;\n\n  return true;\n}\n\nexport function isSignedMultisignatureSendTransaction(\n  data: unknown,\n): data is SignedTransaction<SendTransaction & MultisignatureTx & WithCreator> {\n  if (!isNonNullObject(data)) return false;\n\n  const { transaction, primarySignature, otherSignatures } = data as SignedTransaction;\n\n  if (!isUnsignedMultisignatureSendTransaction(transaction)) return false;\n  if (!isFullSignature(primarySignature)) return false;\n  if (!Array.isArray(otherSignatures) || otherSignatures.some(sig => !isFullSignature(sig))) return false;\n\n  return true;\n}\n\nexport function toPrintableSignature(signature: FullSignature): string {\n  return JSON.stringify(TransactionEncoder.toJson(signature));\n}\n\nexport function fromPrintableSignature(input: string): FullSignature {\n  const fullSignature = TransactionEncoder.fromJson(JSON.parse(input));\n  if (!isFullSignature(fullSignature)) throw new Error(\"Invalid signature format\");\n  return fullSignature;\n}\n\nexport function toPrintableSignedTransaction(transaction: SignedTransaction | UnsignedTransaction): string {\n  return JSON.stringify(TransactionEncoder.toJson(transaction));\n}\n\nexport function makeSignedTransaction(\n  transaction: SendTransaction & MultisignatureTx & WithCreator,\n  signatures: readonly FullSignature[],\n): SignedTransaction<SendTransaction & MultisignatureTx & WithCreator> {\n  const firstSignature = signatures.find(() => true);\n  if (!firstSignature) throw new Error(\"First signature missing\");\n  return {\n    transaction: transaction,\n    primarySignature: firstSignature,\n    otherSignatures: signatures.slice(1),\n  };\n}\n\nexport async function verifySignature(\n  transaction: SendTransaction & MultisignatureTx & WithCreator,\n  signature: FullSignature,\n): Promise<boolean> {\n  const { bytes, prehashType } = bnsCodec.bytesToSign(transaction, signature.nonce);\n\n  switch (prehashType) {\n    case PrehashType.Sha512: {\n      const prehash = new Sha512(bytes).digest();\n      const valid = await Ed25519.verifySignature(signature.signature, prehash, signature.pubkey.data);\n      return valid;\n    }\n    default:\n      throw new Error(\"Unexpected prehash type\");\n  }\n}\n","import { SendTransaction, SignedTransaction, UnsignedTransaction, WithCreator } from \"@iov/bcp\";\nimport { MultisignatureTx } from \"@iov/bns\";\nimport { Encoding, TransactionEncoder } from \"@iov/encoding\";\n\nimport { base64urlDecode, base64urlEncode } from \"./base64url\";\nimport { decodeChecksummed, encodeChecksummed } from \"./checksummed\";\nimport {\n  isSignedMultisignatureSendTransaction,\n  isUnsignedMultisignatureSendTransaction,\n  toPrintableSignedTransaction,\n} from \"./signatures\";\n\nconst { fromUtf8, toUtf8 } = Encoding;\n\nfunction toLinkEncoded(transaction: SignedTransaction | UnsignedTransaction): string {\n  const data = toUtf8(toPrintableSignedTransaction(transaction));\n  return encodeChecksummed(data, base64urlEncode);\n}\n\nexport function signedFromLinkEncoded(\n  encoded: string,\n): SignedTransaction<SendTransaction & MultisignatureTx & WithCreator> {\n  const data = decodeChecksummed(encoded, base64urlDecode);\n  const signedTransaction = TransactionEncoder.fromJson(JSON.parse(fromUtf8(data)));\n  if (!isSignedMultisignatureSendTransaction(signedTransaction)) {\n    throw new Error(\n      \"Transaction data is not an SignedTransaction<SendTransaction & MultisignatureTx & WithCreator>\",\n    );\n  }\n  return signedTransaction;\n}\n\nexport function unsignedFromLinkEncoded(encoded: string): SendTransaction & MultisignatureTx & WithCreator {\n  const data = decodeChecksummed(encoded, base64urlDecode);\n  const unsignedTransaction = TransactionEncoder.fromJson(JSON.parse(fromUtf8(data)));\n  if (!isUnsignedMultisignatureSendTransaction(unsignedTransaction)) {\n    throw new Error(\"Transaction data is not an SendTransaction & MultisignatureTx & WithCreator\");\n  }\n  return unsignedTransaction;\n}\n\nexport function makeStatusLink(\n  signedTransaction: SignedTransaction<SendTransaction & MultisignatureTx & WithCreator>,\n  absolute = false,\n): string {\n  const encodedTransaction = toLinkEncoded(signedTransaction);\n  const prefix = absolute ? window.location.href.split(\"#\")[0] + \"#\" : \"\";\n  const url = `${prefix}/status/${encodedTransaction}`;\n  return url;\n}\n\nexport function makeSigningLink(\n  unsignedTransaction: SendTransaction & MultisignatureTx & WithCreator,\n  absolute = false,\n): string {\n  const encodedTransaction = toLinkEncoded(unsignedTransaction);\n  const prefix = absolute ? window.location.href.split(\"#\")[0] + \"#\" : \"\";\n  const url = `${prefix}/sign/${encodedTransaction}`;\n  return url;\n}\n","import {\n  Address,\n  Algorithm,\n  Amount,\n  ChainId,\n  Nonce,\n  PubkeyBytes,\n  SendTransaction,\n  UnsignedTransaction,\n  WithCreator,\n} from \"@iov/bcp\";\nimport { bnsCodec, multisignatureIdToAddress, MultisignatureTx } from \"@iov/bns\";\nimport { Decimal, Encoding, Uint64 } from \"@iov/encoding\";\nimport equal from \"fast-deep-equal\";\nimport React from \"react\";\nimport Alert from \"react-bootstrap/Alert\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Row from \"react-bootstrap/Row\";\nimport { Redirect } from \"react-router\";\n\nimport ConditionalError from \"./ConditionalError\";\nimport { chains } from \"./settings\";\nimport Transaction from \"./Transaction\";\nimport { amountToString } from \"./util/amounts\";\nimport { getBalance } from \"./util/connection\";\nimport { getErrorMessage } from \"./util/errors\";\nimport { createSigned, getPubkeyFromLedger } from \"./util/ledger\";\nimport { makeStatusLink } from \"./util/links\";\n\ninterface CreateProps {}\n\ninterface CreateState {\n  readonly creatorHex: string;\n  readonly chainId: string;\n  readonly formMultisigContractId: string;\n  readonly formRecipient: string;\n  readonly formQuantity: string;\n  readonly formMemo: string;\n  readonly unsignedTransaction?: UnsignedTransaction & SendTransaction & MultisignatureTx;\n  readonly encodingError: string | null;\n  readonly getPubkeyError?: string;\n  readonly signingError?: string;\n  readonly signing: boolean;\n  readonly statusUrl?: string;\n  readonly lastQueriedMultisigContractId?: string;\n  readonly contractInfo?: {\n    readonly address: Address;\n    readonly balance: readonly Amount[] | undefined;\n  };\n}\n\ntype FormField = \"chainId\" | \"multisigContractId\" | \"recipient\" | \"quantity\" | \"memo\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst emptyState: CreateState = {\n  creatorHex: \"\",\n  chainId: \"iov-mainnet\",\n  formMultisigContractId: \"\",\n  formRecipient: \"\",\n  formQuantity: \"\",\n  formMemo: \"\",\n  encodingError: null,\n  signing: false,\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst testingState: CreateState = {\n  creatorHex: \"\",\n  chainId: \"iov-boarnet\",\n  formMultisigContractId: \"21\",\n  formRecipient: \"tiov1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqplsnxjl\",\n  formQuantity: \"100.56\",\n  formMemo: \"What a wonderful day\",\n  encodingError: null,\n  signing: false,\n};\n\nfunction expectedPrefixforNetwork(network: \"mainnet\" | \"testnet\"): \"iov\" | \"tiov\" {\n  return network === \"mainnet\" ? \"iov\" : \"tiov\";\n}\n\nclass Create extends React.Component<CreateProps, CreateState> {\n  public constructor(props: CreateProps) {\n    super(props);\n    this.state = { ...emptyState };\n  }\n\n  public componentDidUpdate(): void {\n    let encodingError: string | null = null;\n\n    try {\n      const chain = chains.get(this.state.chainId);\n      if (!chain) throw new Error(\"No configuration for theis chain ID found\");\n\n      if (this.state.lastQueriedMultisigContractId !== this.state.formMultisigContractId) {\n        this.setState({\n          lastQueriedMultisigContractId: this.state.formMultisigContractId,\n          contractInfo: undefined,\n        });\n\n        getBalance(chain.id, Uint64.fromString(this.state.formMultisigContractId).toNumber())\n          .then(({ address, balance }) => {\n            this.setState({\n              contractInfo: {\n                address: address,\n                balance: balance,\n              },\n            });\n          })\n          .catch(error => console.error(error));\n      }\n\n      const multisigId = Uint64.fromString(this.state.formMultisigContractId).toNumber();\n      const sender = multisignatureIdToAddress(this.state.chainId as ChainId, multisigId);\n\n      if (!this.state.creatorHex) throw new Error(\"Transaction creator unset\");\n\n      const expectedPrefix = expectedPrefixforNetwork(chain.networkType);\n      if (!this.state.formRecipient.startsWith(expectedPrefix)) {\n        throw new Error(`Recipient address with prefix '${expectedPrefix}' expected`);\n      }\n\n      const tx: SendTransaction & MultisignatureTx & WithCreator = {\n        kind: \"bcp/send\",\n        creator: {\n          chainId: this.state.chainId as ChainId,\n          pubkey: {\n            algo: Algorithm.Ed25519,\n            data: Encoding.fromHex(this.state.creatorHex) as PubkeyBytes,\n          },\n        },\n        amount: {\n          quantity: Decimal.fromUserInput(this.state.formQuantity, 9).atomics,\n          fractionalDigits: 9,\n          tokenTicker: chain.tokenTicker,\n        },\n        sender: sender,\n        recipient: this.state.formRecipient as Address,\n        memo: this.state.formMemo,\n        fee: { tokens: chain.fee },\n        multisig: [multisigId],\n      };\n\n      // test serialization for input validation\n      bnsCodec.bytesToSign(tx, 0 as Nonce);\n\n      if (!equal(this.state.unsignedTransaction, tx)) {\n        this.setState({\n          unsignedTransaction: tx,\n          encodingError: null,\n        });\n      }\n    } catch (error) {\n      encodingError = getErrorMessage(error);\n    }\n\n    if (this.state.encodingError !== encodingError) {\n      this.setState({\n        unsignedTransaction: undefined,\n        encodingError: encodingError,\n      });\n    }\n  }\n\n  public render(): JSX.Element {\n    return (\n      <Container>\n        {this.state.statusUrl && <Redirect to={this.state.statusUrl} push />}\n        <Row>\n          <Col className=\"col-6\">\n            <h3>Enter transaction</h3>\n            <form>\n              <div className=\"form-group\">\n                <label htmlFor=\"chainIdInput\">Chain ID</label>\n                <select\n                  className=\"form-control\"\n                  id=\"chainIdInput\"\n                  value={this.state.chainId}\n                  onChange={e => this.handleFormChange(\"chainId\", e)}\n                >\n                  {Array.from(chains.keys()).map(chainId => (\n                    <option>{chainId}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"creatorInput\">Transaction creator</label>\n                <button\n                  className=\"btn btn-link btn-sm\"\n                  onClick={event => {\n                    event.preventDefault();\n                    this.reloadCreatorFromLedger();\n                  }}\n                >\n                  Get from Ledger\n                </button>\n                <button\n                  className=\"btn btn-link btn-sm\"\n                  onClick={event => {\n                    event.preventDefault();\n                    this.clearCreator();\n                  }}\n                >\n                  Clear\n                </button>\n                <input\n                  id=\"creatorInput\"\n                  className=\"form-control\"\n                  type=\"text\"\n                  placeholder=\"Creator pubkey \"\n                  value={this.state.creatorHex}\n                  disabled\n                />\n                <small className=\"form-text text-muted\">\n                  Pubkey of the person who creates this transaction\n                </small>\n              </div>\n\n              <ConditionalError error={this.state.getPubkeyError} />\n\n              <div className=\"form-group\">\n                <label htmlFor=\"senderInput\">Multisig contract ID</label>\n                <input\n                  id=\"senderInput\"\n                  className=\"form-control\"\n                  type=\"text\"\n                  placeholder=\"Sender\"\n                  value={this.state.formMultisigContractId}\n                  onChange={e => this.handleFormChange(\"multisigContractId\", e)}\n                />\n                <small className=\"form-text text-muted\">Use integer format, e.g. 42</small>\n                <div className=\"invalid-feedback\">Please choose a username.</div>\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"recipientInput\">Recipient address</label>\n                <input\n                  id=\"recipientInput\"\n                  className=\"form-control\"\n                  type=\"text\"\n                  placeholder=\"Recipient\"\n                  value={this.state.formRecipient}\n                  onChange={e => this.handleFormChange(\"recipient\", e)}\n                />\n                <small id=\"emailHelp\" className=\"form-text text-muted\">\n                  IOV address, e.g. iov1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqp396zjw\n                </small>\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"quantityInput\">Quantity</label>\n                <input\n                  id=\"quantityInput\"\n                  className=\"form-control\"\n                  type=\"text\"\n                  placeholder=\"100.56\"\n                  value={this.state.formQuantity}\n                  onChange={e => this.handleFormChange(\"quantity\", e)}\n                />\n                <small className=\"form-text text-muted\">Quantity, e.g. 100.56 for 100.56 IOV</small>\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"memoInput\">Memo</label>\n                <input\n                  id=\"memoInput\"\n                  className=\"form-control\"\n                  type=\"text\"\n                  placeholder=\"Memo\"\n                  value={this.state.formMemo}\n                  onChange={e => this.handleFormChange(\"memo\", e)}\n                />\n                <small id=\"emailHelp\" className=\"form-text text-muted\">\n                  Arbitrary text attached to the transaction\n                </small>\n              </div>\n\n              <p>\n                <button\n                  type=\"submit\"\n                  className=\"btn btn-primary\"\n                  disabled={this.state.signing || !this.state.unsignedTransaction}\n                  onClick={event => {\n                    event.preventDefault();\n                    this.signAndContinue();\n                  }}\n                >\n                  Sign and continue\n                </button>\n              </p>\n\n              <Alert hidden={!this.state.signing} variant=\"info\">\n                Please sign transaction using Ledger device now\n              </Alert>\n              <ConditionalError error={this.state.signingError} />\n            </form>\n          </Col>\n          <Col className=\"col-6\">\n            <h3>Multisig contract info</h3>\n            {this.state.contractInfo && (\n              <p>\n                Address: {this.state.contractInfo.address}\n                <br />\n                Balance:{\" \"}\n                {this.state.contractInfo.balance\n                  ? this.state.contractInfo.balance.map(amountToString).join(\", \")\n                  : \"â€“\"}\n              </p>\n            )}\n\n            <h3>Details</h3>\n            {this.state.unsignedTransaction && (\n              <div>\n                <p>This is a machine processable representation of the transaction.</p>\n                <Transaction transaction={this.state.unsignedTransaction} />\n              </div>\n            )}\n            <Alert variant=\"danger\" hidden={!this.state.encodingError}>\n              <p className=\"mb-0\">\n                <strong>Transaction encoding error:</strong>\n                <br />\n                {this.state.encodingError}\n              </p>\n            </Alert>\n          </Col>\n        </Row>\n      </Container>\n    );\n  }\n\n  private handleFormChange(\n    field: FormField,\n    event: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>,\n  ): void {\n    const newValue = event.target.value;\n\n    switch (field) {\n      case \"chainId\":\n        this.setState({ chainId: newValue });\n        break;\n      case \"multisigContractId\":\n        this.setState({ formMultisigContractId: newValue });\n        break;\n      case \"recipient\":\n        this.setState({ formRecipient: newValue });\n        break;\n      case \"quantity\":\n        this.setState({ formQuantity: newValue });\n        break;\n      case \"memo\":\n        this.setState({ formMemo: newValue });\n        break;\n      default:\n        throw new Error(`Unsupported form field '${field}'`);\n    }\n  }\n\n  private clearCreator(): void {\n    this.setState({\n      creatorHex: \"\",\n      getPubkeyError: undefined,\n    });\n  }\n\n  private reloadCreatorFromLedger(): void {\n    this.clearCreator();\n\n    const chain = chains.get(this.state.chainId);\n    if (!chain) throw new Error(\"Chain not found\");\n\n    getPubkeyFromLedger(chain.networkType).then(\n      response => {\n        const pubkeyHex = Encoding.toHex(response.pubkey);\n        console.log(\"Received pubkey from Ledger:\", pubkeyHex);\n        this.setState({ creatorHex: pubkeyHex });\n      },\n      error => {\n        console.info(\"Full error message\", error);\n        this.setState({ getPubkeyError: getErrorMessage(error) });\n      },\n    );\n  }\n\n  private signAndContinue(): void {\n    this.setState({\n      signingError: undefined,\n      signing: true,\n    });\n\n    if (!this.state.unsignedTransaction) throw new Error(\"unsigned transaction not set\");\n    createSigned(this.state.unsignedTransaction).then(\n      signed => {\n        const statusUrl = makeStatusLink(signed);\n        console.log(\"Navigating to\", statusUrl);\n        this.setState({\n          statusUrl: statusUrl,\n          signing: false,\n        });\n      },\n      error => {\n        console.info(\"Full error message\", error);\n        this.setState({\n          signingError: getErrorMessage(error),\n          signing: false,\n        });\n      },\n    );\n  }\n}\n\nexport default Create;\n","import { Algorithm, Identity, PubkeyBytes, SendTransaction, WithCreator } from \"@iov/bcp\";\nimport { MultisignatureTx } from \"@iov/bns\";\nimport React from \"react\";\nimport Alert from \"react-bootstrap/Alert\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Row from \"react-bootstrap/Row\";\n\nimport ConditionalError from \"./ConditionalError\";\nimport { chains } from \"./settings\";\nimport Transaction from \"./Transaction\";\nimport { getErrorMessage } from \"./util/errors\";\nimport { createSignature, getPubkeyFromLedger } from \"./util/ledger\";\nimport { unsignedFromLinkEncoded } from \"./util/links\";\nimport { toPrintableSignature } from \"./util/signatures\";\n\ninterface SignProps {}\n\ninterface SignState {\n  readonly transaction: (SendTransaction & MultisignatureTx & WithCreator) | null;\n  readonly localSignature: string;\n  readonly signingError?: string;\n  readonly globalError?: string;\n  readonly signing: boolean;\n}\n\nclass Sign extends React.Component<SignProps, SignState> {\n  public constructor(props: SignProps) {\n    super(props);\n    this.state = {\n      transaction: null,\n      localSignature: \"\",\n      signing: false,\n    };\n  }\n\n  public componentDidMount(): void {\n    if (!this.state.transaction) {\n      const matches = window.location.href.match(/\\/sign\\/([-_=a-zA-Z0-9]+)/);\n      if (matches && matches.length >= 2) {\n        try {\n          const unsigned = unsignedFromLinkEncoded(matches[1]);\n          this.setState({ transaction: unsigned });\n        } catch (error) {\n          console.warn(\"Full error message\", error);\n          this.setState({ globalError: \"Error in URL: \" + getErrorMessage(error) });\n        }\n      } else {\n        this.setState({ globalError: \"Error in URL: Transaction missing\" });\n      }\n    }\n  }\n\n  public render(): JSX.Element {\n    return (\n      <Container>\n        <Row>\n          <Col>\n            <ConditionalError error={this.state.globalError} />\n          </Col>\n        </Row>\n        <Row>\n          <Col className=\"col-6\">\n            <h2>Review transaction</h2>\n            {this.state.transaction && <Transaction transaction={this.state.transaction} />}\n          </Col>\n          <Col className=\"col-6\">\n            <h2>Create Signature</h2>\n\n            <div className=\"form-group\">\n              <label htmlFor=\"yourSignature\">Your signature</label>\n              <textarea\n                className=\"form-control\"\n                id=\"yourSignature\"\n                rows={6}\n                value={this.state.localSignature}\n                readOnly={true}\n              ></textarea>\n            </div>\n\n            <p>\n              <button\n                className=\"btn btn-primary\"\n                onClick={async event => {\n                  event.preventDefault();\n                  this.setState({ localSignature: \"\", signingError: undefined, signing: true });\n\n                  try {\n                    const signature = await this.createSignature();\n                    this.setState({\n                      localSignature: signature,\n                      signing: false,\n                    });\n                  } catch (error) {\n                    console.info(\"Full error message\", error);\n                    const errorMessage = getErrorMessage(error);\n                    this.setState({\n                      signingError: errorMessage,\n                      signing: false,\n                    });\n                  }\n                }}\n              >\n                Sign transaction now\n              </button>\n            </p>\n\n            <Alert hidden={!this.state.signing} variant=\"info\">\n              Please sign transaction using Ledger device now\n            </Alert>\n            <ConditionalError error={this.state.signingError} />\n          </Col>\n        </Row>\n        <Row>\n          <Col>&nbsp;</Col>\n        </Row>\n      </Container>\n    );\n  }\n\n  private async createSignature(): Promise<string> {\n    const original = this.state.transaction;\n    if (!original) throw new Error(\"Transaction not set\");\n\n    const chain = chains.get(original.creator.chainId);\n    if (!chain) throw new Error(\"Chain not found\");\n\n    const pubkeyResponse = await getPubkeyFromLedger(chain.networkType);\n\n    const signer: Identity = {\n      chainId: original.creator.chainId,\n      pubkey: {\n        algo: Algorithm.Ed25519,\n        data: pubkeyResponse.pubkey as PubkeyBytes,\n      },\n    };\n\n    const signature = await createSignature(original, signer);\n    return toPrintableSignature(signature);\n  }\n}\n\nexport default Sign;\n","import React from \"react\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Row from \"react-bootstrap/Row\";\nimport { Link } from \"react-router-dom\";\n\ninterface StartProps {}\n\nclass Start extends React.Component<StartProps, {}> {\n  public render(): JSX.Element {\n    return (\n      <Container>\n        <Row>\n          <Col>\n            <h1>Multitool</h1>\n            <h2>Create multisignatures transactions using Ledger Nano S</h2>\n          </Col>\n        </Row>\n        <Row>\n          <Col className=\"\"></Col>\n          <Col className=\"col-4\">\n            <Link to=\"/create\" className=\"btn btn-lg btn-block btn-primary\">\n              Create new transaction\n            </Link>\n          </Col>\n          <Col className=\"\"></Col>\n          <Col className=\"col-4\">&nbsp;</Col>\n          <Col className=\"\"></Col>\n        </Row>\n      </Container>\n    );\n  }\n}\n\nexport default Start;\n","import { ChainId, FullSignature } from \"@iov/bcp\";\nimport { bnsCodec } from \"@iov/bns\";\nimport { Encoding } from \"@iov/encoding\";\nimport React from \"react\";\nimport Alert from \"react-bootstrap/Alert\";\n\nimport { getNonce } from \"./util/connection\";\nimport { toPrintableSignature } from \"./util/signatures\";\nimport { ellideMiddle } from \"./util/text\";\n\nconst { toHex } = Encoding;\n\ninterface NonceStatus {\n  readonly error?: {\n    readonly received: number;\n    readonly expected: number;\n  };\n}\n\ninterface SignatureProps {\n  readonly index: number;\n  readonly chainId: ChainId;\n  readonly signature: FullSignature;\n  readonly noneStatus?: NonceStatus;\n}\n\nconst Signature = ({ index, chainId, signature, noneStatus }: SignatureProps): JSX.Element => {\n  const address = bnsCodec.identityToAddress({ chainId: chainId, pubkey: signature.pubkey });\n  return (\n    <li className=\"list-group-item last-child-no-bottom-margin\" key={toHex(signature.pubkey.data)}>\n      <h5>\n        {`#${index + 1}`} {ellideMiddle(address, 22)}\n      </h5>\n      <p className=\"text-muted text-break\">{toPrintableSignature(signature)}</p>\n      {noneStatus && noneStatus.error && (\n        <Alert variant=\"warning\">\n          Nonce outdated. In signature: {noneStatus.error.received}; Expected: {noneStatus.error.expected}\n        </Alert>\n      )}\n    </li>\n  );\n};\n\ninterface SignaturesListPros {\n  readonly chainId: ChainId;\n  readonly signatures: readonly FullSignature[];\n}\n\ninterface SignaturesListState {\n  readonly nonceStatuses: readonly NonceStatus[];\n}\n\nclass SignaturesList extends React.Component<SignaturesListPros, SignaturesListState> {\n  private interval: NodeJS.Timeout | undefined;\n\n  public constructor(props: SignaturesListPros) {\n    super(props);\n    this.state = {\n      nonceStatuses: props.signatures.map((_): NonceStatus => ({})),\n    };\n  }\n\n  public componentDidMount(): void {\n    const runCheck = async (): Promise<void> => {\n      try {\n        const statuses = await Promise.all(\n          this.props.signatures.map(\n            async (signature): Promise<NonceStatus> => {\n              const latestNonce = await getNonce(this.props.chainId, signature.pubkey);\n              if (signature.nonce === latestNonce) {\n                return {};\n              } else {\n                return {\n                  error: {\n                    expected: latestNonce,\n                    received: signature.nonce,\n                  },\n                };\n              }\n            },\n          ),\n        );\n        this.setState({ nonceStatuses: statuses });\n      } catch (error) {\n        console.warn(error);\n      }\n    };\n\n    setTimeout(runCheck, 300); // initial run\n    this.interval = setInterval(runCheck, 7000);\n  }\n\n  public componentWillUnmount(): void {\n    if (this.interval) clearTimeout(this.interval);\n    this.interval = undefined;\n  }\n\n  public render(): JSX.Element {\n    return (\n      <ol className=\"list-group mb-3\">\n        {this.props.signatures.map((signature, index) => (\n          <Signature\n            key={toHex(signature.signature)}\n            index={index}\n            chainId={this.props.chainId}\n            signature={signature}\n            noneStatus={this.state.nonceStatuses[index]}\n          />\n        ))}\n      </ol>\n    );\n  }\n}\n\nexport default SignaturesList;\n","export function ellideMiddle(str: string, maxOutLen: number): string {\n  if (str.length <= maxOutLen) {\n    return str;\n  }\n  const ellide = \"â€¦\";\n  const frontLen = Math.ceil((maxOutLen - ellide.length) / 2);\n  const tailLen = Math.floor((maxOutLen - ellide.length) / 2);\n  return str.slice(0, frontLen) + ellide + str.slice(-tailLen);\n}\n","import { FullSignature, SendTransaction, TransactionId, WithCreator } from \"@iov/bcp\";\nimport { MultisignatureTx } from \"@iov/bns\";\nimport React from \"react\";\nimport Alert from \"react-bootstrap/Alert\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Row from \"react-bootstrap/Row\";\n\nimport ConditionalError from \"./ConditionalError\";\nimport SignaturesList from \"./SignaturesList\";\nimport Transaction from \"./Transaction\";\nimport { arrayEquals } from \"./util/arrays\";\nimport { postSignedTransaction } from \"./util/connection\";\nimport { getErrorMessage } from \"./util/errors\";\nimport { makeSigningLink, signedFromLinkEncoded } from \"./util/links\";\nimport { fromPrintableSignature, makeSignedTransaction, verifySignature } from \"./util/signatures\";\n\ninterface StatusProps {}\n\ninterface StatusState {\n  readonly transaction: (SendTransaction & MultisignatureTx & WithCreator) | null;\n  readonly signatures: readonly FullSignature[];\n  readonly localSignature: string;\n  readonly addSignatureError?: string;\n  readonly posting: boolean;\n  readonly postError?: string;\n  readonly postSuccess?: TransactionId;\n  readonly globalError?: string;\n}\n\nclass Status extends React.Component<StatusProps, StatusState> {\n  public constructor(props: StatusProps) {\n    super(props);\n    this.state = {\n      transaction: null,\n      signatures: [],\n      localSignature: \"\",\n      posting: false,\n    };\n  }\n\n  public componentDidMount(): void {\n    if (!this.state.transaction) {\n      const matches = window.location.href.match(/\\/status\\/([-_=a-zA-Z0-9]+)/);\n      if (matches && matches.length >= 2) {\n        try {\n          const signedTransaction = signedFromLinkEncoded(matches[1]);\n          const { transaction, primarySignature, otherSignatures } = signedTransaction;\n          this.setState({\n            transaction: transaction,\n            signatures: [primarySignature, ...otherSignatures],\n          });\n        } catch (error) {\n          console.warn(\"Full error message\", error);\n          this.setState({ globalError: \"Error in URL: \" + getErrorMessage(error) });\n        }\n      } else {\n        this.setState({ globalError: \"Error in URL: Transaction missing\" });\n      }\n    }\n  }\n\n  public render(): JSX.Element {\n    return (\n      <Container>\n        <Row>\n          <Col>\n            <ConditionalError error={this.state.globalError} />\n          </Col>\n        </Row>\n        <Row>\n          <Col>\n            <h2>Signing link</h2>\n\n            <div className=\"form-group\">\n              <label htmlFor=\"signingLink\">\n                Send this link to every user supposed to sign this transaction\n              </label>\n              <input\n                className=\"form-control\"\n                id=\"signingLink\"\n                value={this.state.transaction ? makeSigningLink(this.state.transaction, true) : \"\"}\n                readOnly={true}\n              />\n            </div>\n          </Col>\n        </Row>\n        <Row>\n          <Col className=\"col-6\">\n            <h2>Review transaction</h2>\n            {this.state.transaction && <Transaction transaction={this.state.transaction} />}\n          </Col>\n          <Col className=\"col-6\">\n            <h2>Signatures</h2>\n            {this.state.transaction && (\n              <SignaturesList\n                chainId={this.state.transaction.creator.chainId}\n                signatures={this.state.signatures}\n              />\n            )}\n\n            <p>\n              <button\n                className=\"btn btn-primary btn-sm\"\n                onClick={event => {\n                  event.preventDefault();\n                  this.addSignature();\n                }}\n              >\n                Add signature\n              </button>\n            </p>\n            <ConditionalError error={this.state.addSignatureError} />\n\n            <h2>Post to blockchain</h2>\n            <div hidden={!!this.state.postSuccess}>\n              <p>The transaction with all signatures from above will be posted to the IOV blockchain.</p>\n              <p>\n                <button\n                  className=\"btn btn-primary\"\n                  disabled={this.state.posting}\n                  onClick={event => {\n                    event.preventDefault();\n                    this.postToChain();\n                  }}\n                >\n                  Post now\n                </button>\n              </p>\n            </div>\n            <Alert variant=\"success\" hidden={!this.state.postSuccess}>\n              <p>Sucessfully posted transaction with ID {this.state.postSuccess} to the blockchain.</p>\n            </Alert>\n            <ConditionalError error={this.state.postError} />\n          </Col>\n        </Row>\n        <Row>\n          <Col>&nbsp;</Col>\n        </Row>\n      </Container>\n    );\n  }\n\n  private async addSignature(): Promise<void> {\n    if (!this.state.transaction) throw new Error(\"Original transaction not set\");\n\n    this.setState({ addSignatureError: undefined });\n\n    const signatureInput = prompt(\"Please enter signature\");\n    if (signatureInput === null) return;\n\n    try {\n      const newSignature = fromPrintableSignature(signatureInput);\n\n      if (!(await verifySignature(this.state.transaction, newSignature))) {\n        throw new Error(\"Signature is not valid for this transaction\");\n      }\n\n      const existing = this.state.signatures.map(fullSignature => fullSignature.signature);\n      if (existing.find(signature => arrayEquals(signature, newSignature.signature))) {\n        throw new Error(\"This signature is already included\");\n      }\n\n      /** signatures by other accounts */\n      const otherSignatures = this.state.signatures.filter(\n        signature => !arrayEquals(signature.pubkey.data, newSignature.pubkey.data),\n      );\n\n      this.setState({\n        signatures: [...otherSignatures, newSignature],\n      });\n    } catch (error) {\n      console.info(\"Full error message\", error);\n      this.setState({ addSignatureError: getErrorMessage(error) });\n    }\n  }\n\n  private postToChain(): void {\n    if (!this.state.transaction) throw new Error(\"Original transaction not set\");\n    const signed = makeSignedTransaction(this.state.transaction, this.state.signatures);\n\n    this.setState({\n      posting: true,\n      postError: undefined,\n    });\n    postSignedTransaction(signed).then(\n      transactionId => {\n        console.log(\"Successfully posted\", transactionId);\n        this.setState({\n          posting: false,\n          postError: undefined,\n          postSuccess: transactionId,\n        });\n      },\n      error => {\n        console.info(\"Full error message\", error);\n        this.setState({\n          posting: false,\n          postError: getErrorMessage(error),\n        });\n      },\n    );\n  }\n}\n\nexport default Status;\n","import \"bootstrap/dist/css/bootstrap.css\";\nimport \"./index.css\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Route, Switch } from \"react-router\";\nimport { HashRouter } from \"react-router-dom\";\n\nimport Create from \"./Create\";\nimport Sign from \"./Sign\";\nimport Start from \"./Start\";\nimport Status from \"./Status\";\n\nReactDOM.render(\n  <HashRouter>\n    <Switch>\n      <Route exact path=\"/create\" component={Create} />\n      <Route path=\"/status\" component={Status} />\n      <Route path=\"/sign\" component={Sign} />\n      <Route path=\"/\" component={Start} />\n    </Switch>\n  </HashRouter>,\n  document.getElementById(\"root\"),\n);\n"],"sourceRoot":""}