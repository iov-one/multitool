(this.webpackJsonpmultitool=this.webpackJsonpmultitool||[]).push([[0],{117:function(e,t){},179:function(e,t,n){e.exports=n(375)},181:function(e,t,n){},194:function(e,t){},201:function(e,t){},203:function(e,t){},250:function(e,t){},375:function(e,t,n){"use strict";n.r(t);n(180),n(181);var a=n(0),r=n.n(a),s=n(66),i=n.n(s),o=n(16),c=n(67),l=n(178),u=n(29),m=n(30),h=n(33),d=n(31),p=n(34),f=n(11),g=n(17),b=n(3),E=n(90),v=n.n(E),w=n(26),y=n(12),k=n(39),x=n(19),S=function(e){var t=e.error;return r.a.createElement(w.a,{variant:"danger",hidden:!t},t)},I=new Map([["local-iov-devnet",{id:"local-iov-devnet",tokenTicker:"CASH",fee:{quantity:"100000000",fractionalDigits:9,tokenTicker:"CASH"},nodeUrl:"ws://localhost:23456/",networkType:"testnet"}],["iov-babynet",{id:"iov-babynet",tokenTicker:"IOV",fee:{quantity:"500000000",fractionalDigits:9,tokenTicker:"IOV"},nodeUrl:"wss://rpc-private-a-vip-babynet.iov.one",networkType:"testnet"}],["iov-clapnet",{id:"iov-clapnet",tokenTicker:"IOV",fee:{quantity:"500000000",fractionalDigits:9,tokenTicker:"IOV"},nodeUrl:"wss://rpc-private-a-vip2-clapnet.iov.one",networkType:"testnet"}],["iov-mainnet",{id:"iov-mainnet",tokenTicker:"IOV",fee:{quantity:"500000000",fractionalDigits:9,tokenTicker:"IOV"},nodeUrl:"wss://rpc-private-a-vip-mainnet.iov.one",networkType:"mainnet"}]]);var O=function(e){var t=e.transaction;return r.a.createElement("pre",null,function(e){var t="string"===typeof e?JSON.parse(e):e;return JSON.stringify(t,null,2)}(b.TransactionEncoder.toJson(t)))};function T(e){var t=e.quantity,n=e.fractionalDigits,a=e.tokenTicker;return"".concat(b.Decimal.fromAtomics(t,n).toString()," ").concat(a)}var C=n(1),N=n.n(C);function j(e){var t,n;return N.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=I.get(e)){a.next=3;break}throw new Error("Chain not found");case 3:return n=Object(g.createBnsConnector)(t.nodeUrl,e),a.abrupt("return",n);case 5:case"end":return a.stop()}}))}function q(e,t){var n,a,r;return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,N.a.awrap(j(e));case 2:return n=s.sent,s.next=5,N.a.awrap(n.establishConnection());case 5:return a=s.sent,s.next=8,N.a.awrap(a.getNonce({pubkey:t}));case 8:return r=s.sent,a.disconnect(),s.abrupt("return",r);case 11:case"end":return s.stop()}}))}function M(e){return e instanceof Error?e.message:"".concat(e)}var F=n(43),A=n(92),U=n.n(A),D=0;function L(e){var t,n,a,r,s;return N.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,N.a.awrap(U.a.create(1e3));case 2:return t=i.sent,i.prev=3,n=new F.IovLedgerApp(t),i.next=7,N.a.awrap(n.getVersion());case 7:if(a=i.sent,Object(F.isIovLedgerAppVersion)(a)){i.next=10;break}throw new Error(a.errorMessage);case 10:if(r=a.testMode?"testnet":"mainnet",e===r){i.next=13;break}throw new Error("Pubkey for ".concat(e," required but got response from the ").concat(r," app"));case 13:return i.next=15,N.a.awrap(n.getAddress(D));case 15:if(s=i.sent,Object(F.isIovLedgerAppAddress)(s)){i.next=18;break}throw new Error(s.errorMessage);case 18:return i.abrupt("return",{pubkey:s.pubkey});case 19:return i.prev=19,i.next=22,N.a.awrap(t.close());case 22:return i.finish(19);case 23:case"end":return i.stop()}}),null,null,[[3,,19,23]])}function P(e,t){var n,a,r,s,i,o,c,l,u;return N.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,N.a.awrap(q(t.chainId,t.pubkey));case 2:return n=m.sent,a=g.bnsCodec.bytesToSign(e,n),r=a.bytes,s="iov-mainnet"===t.chainId?"mainnet":"testnet",m.next=7,N.a.awrap(U.a.create(5e3));case 7:return i=m.sent,m.prev=8,o=new F.IovLedgerApp(i),m.next=12,N.a.awrap(o.getVersion());case 12:if(c=m.sent,Object(F.isIovLedgerAppVersion)(c)){m.next=15;break}throw new Error(c.errorMessage);case 15:if(l=c.testMode?"testnet":"mainnet",s===l){m.next=18;break}throw new Error("Pubkey for ".concat(s," required but got response from the ").concat(l," app"));case 18:return m.next=20,N.a.awrap(o.sign(D,r));case 20:if(u=m.sent,Object(F.isIovLedgerAppSignature)(u)){m.next=23;break}throw new Error(u.errorMessage);case 23:return m.abrupt("return",{pubkey:t.pubkey,nonce:n,signature:u.signature});case 24:return m.prev=24,m.next=27,N.a.awrap(i.close());case 27:return m.finish(24);case 28:case"end":return m.stop()}}),null,null,[[8,,24,28]])}function J(e){return b.Encoding.toBase64(e).replace("+","-").replace("/","_")}function R(e){return b.Encoding.fromBase64(e.replace("-","+").replace("_","/"))}var H=n(47),V=n(28);function B(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}var Q=4;function W(e){return new V.Sha256(e).digest().slice(0,Q)}function _(e,t){var n=t(e),a=n.slice(0,Q),r=n.slice(Q);if(!B(a,W(r)))throw new Error("Checksum mismatch");return r}function z(e){if(!Object(b.isNonNullObject)(e))return!1;var t=e;return!!Object(f.isUnsignedTransaction)(t)&&(!!Object(f.isSendTransaction)(t)&&!!Object(g.isMultisignatureTx)(t))}function Z(e){return JSON.stringify(b.TransactionEncoder.toJson(e))}function G(e){var t=b.TransactionEncoder.fromJson(JSON.parse(e));if(!Object(f.isFullSignature)(t))throw new Error("Invalid signature format");return t}function Y(e,t){var n,a,r,s,i;return N.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:n=g.bnsCodec.bytesToSign(e,t.nonce),a=n.bytes,r=n.prehashType,o.t0=r,o.next=o.t0===f.PrehashType.Sha512?4:9;break;case 4:return s=new V.Sha512(a).digest(),o.next=7,N.a.awrap(V.Ed25519.verifySignature(t.signature,s,t.pubkey.data));case 7:return i=o.sent,o.abrupt("return",i);case 9:throw new Error("Unexpected prehash type");case 10:case"end":return o.stop()}}))}var K=b.Encoding.fromUtf8,X=b.Encoding.toUtf8;function $(e){return function(e,t){var n=W(e);return t(new Uint8Array([].concat(Object(H.a)(n),Object(H.a)(e))))}(X(function(e){return JSON.stringify(b.TransactionEncoder.toJson(e))}(e)),J)}function ee(e){var t=_(e,R),n=b.TransactionEncoder.fromJson(JSON.parse(K(t)));if(!function(e){if(!Object(b.isNonNullObject)(e))return!1;var t=e,n=t.transaction,a=t.primarySignature,r=t.otherSignatures;return!!z(n)&&(!!Object(f.isFullSignature)(a)&&!(!Array.isArray(r)||r.some((function(e){return!Object(f.isFullSignature)(e)}))))}(n))throw new Error("Transaction data is not an SignedTransaction<SendTransaction & MultisignatureTx & WithCreator>");return n}function te(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=$(e),a=t?window.location.href.split("#")[0]+"#":"";return"".concat(a,"/sign/").concat(n)}var ne={creatorHex:"",chainId:"iov-mainnet",formMultisigContractId:"",formRecipient:"",formQuantity:"",formMemo:"",encodingError:null,signing:!1};var ae=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state=Object(l.a)({},ne),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(){var e=this,t=null;try{var n=I.get(this.state.chainId);if(!n)throw new Error("No configuration for theis chain ID found");this.state.lastQueriedMultisigContractId!==this.state.formMultisigContractId&&(this.setState({lastQueriedMultisigContractId:this.state.formMultisigContractId,contractInfo:void 0}),function(e,t){var n,a,r,s;return N.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return n=Object(g.multisignatureIdToAddress)(e,t),i.next=3,N.a.awrap(j(e));case 3:return a=i.sent,i.next=6,N.a.awrap(a.establishConnection());case 6:return r=i.sent,i.next=9,N.a.awrap(r.getAccount({address:n}));case 9:return s=i.sent,r.disconnect(),i.abrupt("return",{address:n,balance:s?s.balance:void 0});case 12:case"end":return i.stop()}}))}(n.id,b.Uint64.fromString(this.state.formMultisigContractId).toNumber()).then((function(t){var n=t.address,a=t.balance;e.setState({contractInfo:{address:n,balance:a}})})).catch((function(e){return console.error(e)})));var a=b.Uint64.fromString(this.state.formMultisigContractId).toNumber(),r=Object(g.multisignatureIdToAddress)(this.state.chainId,a);if(!this.state.creatorHex)throw new Error("Transaction creator unset");var s="mainnet"===n.networkType?"iov":"tiov";if(!this.state.formRecipient.startsWith(s))throw new Error("Recipient address with prefix '".concat(s,"' expected"));var i={kind:"bcp/send",creator:{chainId:this.state.chainId,pubkey:{algo:f.Algorithm.Ed25519,data:b.Encoding.fromHex(this.state.creatorHex)}},amount:{quantity:b.Decimal.fromUserInput(this.state.formQuantity,9).atomics,fractionalDigits:9,tokenTicker:n.tokenTicker},sender:r,recipient:this.state.formRecipient,memo:this.state.formMemo,fee:{tokens:n.fee},multisig:[a]};g.bnsCodec.bytesToSign(i,0),v()(this.state.unsignedTransaction,i)||this.setState({unsignedTransaction:i,encodingError:null})}catch(o){t=M(o)}this.state.encodingError!==t&&this.setState({unsignedTransaction:void 0,encodingError:t})}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,null,this.state.statusUrl&&r.a.createElement(o.a,{to:this.state.statusUrl,push:!0}),r.a.createElement(x.a,null,r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h3",null,"Enter transaction"),r.a.createElement("form",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"chainIdInput"},"Chain ID"),r.a.createElement("select",{className:"form-control",id:"chainIdInput",value:this.state.chainId,onChange:function(t){return e.handleFormChange("chainId",t)}},Array.from(I.keys()).map((function(e){return r.a.createElement("option",null,e)})))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"creatorInput"},"Transaction creator"),r.a.createElement("button",{className:"btn btn-link btn-sm",onClick:function(t){t.preventDefault(),e.reloadCreatorFromLedger()}},"Get from Ledger"),r.a.createElement("button",{className:"btn btn-link btn-sm",onClick:function(t){t.preventDefault(),e.clearCreator()}},"Clear"),r.a.createElement("input",{id:"creatorInput",className:"form-control",type:"text",placeholder:"Creator pubkey ",value:this.state.creatorHex,disabled:!0}),r.a.createElement("small",{className:"form-text text-muted"},"Pubkey of the person who creates this transaction")),r.a.createElement(S,{error:this.state.getPubkeyError}),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"senderInput"},"Multisig contract ID"),r.a.createElement("input",{id:"senderInput",className:"form-control",type:"text",placeholder:"Sender",value:this.state.formMultisigContractId,onChange:function(t){return e.handleFormChange("multisigContractId",t)}}),r.a.createElement("small",{className:"form-text text-muted"},"Use integer format, e.g. 42"),r.a.createElement("div",{className:"invalid-feedback"},"Please choose a username.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"recipientInput"},"Recipient address"),r.a.createElement("input",{id:"recipientInput",className:"form-control",type:"text",placeholder:"Recipient",value:this.state.formRecipient,onChange:function(t){return e.handleFormChange("recipient",t)}}),r.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"IOV address, e.g. iov1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqp396zjw")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"quantityInput"},"Quantity"),r.a.createElement("input",{id:"quantityInput",className:"form-control",type:"text",placeholder:"100.56",value:this.state.formQuantity,onChange:function(t){return e.handleFormChange("quantity",t)}}),r.a.createElement("small",{className:"form-text text-muted"},"Quantity, e.g. 100.56 for 100.56 IOV")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"memoInput"},"Memo"),r.a.createElement("input",{id:"memoInput",className:"form-control",type:"text",placeholder:"Memo",value:this.state.formMemo,onChange:function(t){return e.handleFormChange("memo",t)}}),r.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"Arbitrary text attached to the transaction")),r.a.createElement("p",null,r.a.createElement("button",{type:"submit",className:"btn btn-primary",disabled:this.state.signing||!this.state.unsignedTransaction,onClick:function(t){t.preventDefault(),e.signAndContinue()}},"Sign and continue")),r.a.createElement(w.a,{hidden:!this.state.signing,variant:"info"},"Please sign transaction using Ledger device now"),r.a.createElement(S,{error:this.state.signingError}))),r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h3",null,"Multisig contract info"),this.state.contractInfo&&r.a.createElement("p",null,"Address: ",this.state.contractInfo.address,r.a.createElement("br",null),"Balance:"," ",this.state.contractInfo.balance?this.state.contractInfo.balance.map(T).join(", "):"\u2013"),r.a.createElement("h3",null,"Details"),this.state.unsignedTransaction&&r.a.createElement("div",null,r.a.createElement("p",null,"This is a machine processable representation of the transaction."),r.a.createElement(O,{transaction:this.state.unsignedTransaction})),r.a.createElement(w.a,{variant:"danger",hidden:!this.state.encodingError},r.a.createElement("p",{className:"mb-0"},r.a.createElement("strong",null,"Transaction encoding error:"),r.a.createElement("br",null),this.state.encodingError)))))}},{key:"handleFormChange",value:function(e,t){var n=t.target.value;switch(e){case"chainId":this.setState({chainId:n});break;case"multisigContractId":this.setState({formMultisigContractId:n});break;case"recipient":this.setState({formRecipient:n});break;case"quantity":this.setState({formQuantity:n});break;case"memo":this.setState({formMemo:n});break;default:throw new Error("Unsupported form field '".concat(e,"'"))}}},{key:"clearCreator",value:function(){this.setState({creatorHex:"",getPubkeyError:void 0})}},{key:"reloadCreatorFromLedger",value:function(){var e=this;this.clearCreator();var t=I.get(this.state.chainId);if(!t)throw new Error("Chain not found");L(t.networkType).then((function(t){var n=b.Encoding.toHex(t.pubkey);console.log("Received pubkey from Ledger:",n),e.setState({creatorHex:n})}),(function(t){console.info("Full error message",t),e.setState({getPubkeyError:M(t)})}))}},{key:"signAndContinue",value:function(){var e=this;if(this.setState({signingError:void 0,signing:!0}),!this.state.unsignedTransaction)throw new Error("unsigned transaction not set");(function(e){var t;return N.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,N.a.awrap(P(e,e.creator));case 2:return t=n.sent,n.abrupt("return",{transaction:e,primarySignature:t,otherSignatures:[]});case 4:case"end":return n.stop()}}))})(this.state.unsignedTransaction).then((function(t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=$(e),a=t?window.location.href.split("#")[0]+"#":"";return"".concat(a,"/status/").concat(n)}(t);console.log("Navigating to",n),e.setState({statusUrl:n,signing:!1})}),(function(t){console.info("Full error message",t),e.setState({signingError:M(t),signing:!1})}))}}]),t}(r.a.Component),re=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={transaction:null,localSignature:"",signing:!1},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){if(!this.state.transaction){var e=window.location.href.match(/\/sign\/([-_=a-zA-Z0-9]+)/);if(e&&e.length>=2)try{var t=function(e){var t=_(e,R),n=b.TransactionEncoder.fromJson(JSON.parse(K(t)));if(!z(n))throw new Error("Transaction data is not an SendTransaction & MultisignatureTx & WithCreator");return n}(e[1]);this.setState({transaction:t})}catch(n){console.warn("Full error message",n),this.setState({globalError:"Error in URL: "+M(n)})}else this.setState({globalError:"Error in URL: Transaction missing"})}}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,null,r.a.createElement(x.a,null,r.a.createElement(y.a,null,r.a.createElement(S,{error:this.state.globalError}))),r.a.createElement(x.a,null,r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h2",null,"Review transaction"),this.state.transaction&&r.a.createElement(O,{transaction:this.state.transaction})),r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h2",null,"Create Signature"),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"yourSignature"},"Your signature"),r.a.createElement("textarea",{className:"form-control",id:"yourSignature",rows:6,value:this.state.localSignature,readOnly:!0})),r.a.createElement("p",null,r.a.createElement("button",{className:"btn btn-primary",onClick:function(t){var n,a;return N.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t.preventDefault(),e.setState({localSignature:"",signingError:void 0,signing:!0}),r.prev=2,r.next=5,N.a.awrap(e.createSignature());case 5:n=r.sent,e.setState({localSignature:n,signing:!1}),r.next=14;break;case 9:r.prev=9,r.t0=r.catch(2),console.info("Full error message",r.t0),a=M(r.t0),e.setState({signingError:a,signing:!1});case 14:case"end":return r.stop()}}),null,null,[[2,9]])}},"Sign transaction now")),r.a.createElement(w.a,{hidden:!this.state.signing,variant:"info"},"Please sign transaction using Ledger device now"),r.a.createElement(S,{error:this.state.signingError}))),r.a.createElement(x.a,null,r.a.createElement(y.a,null,"\xa0")))}},{key:"createSignature",value:function(){var e,t,n,a,r;return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(e=this.state.transaction){s.next=3;break}throw new Error("Transaction not set");case 3:if(t=I.get(e.creator.chainId)){s.next=6;break}throw new Error("Chain not found");case 6:return s.next=8,N.a.awrap(L(t.networkType));case 8:return n=s.sent,a={chainId:e.creator.chainId,pubkey:{algo:f.Algorithm.Ed25519,data:n.pubkey}},s.next=12,N.a.awrap(P(e,a));case 12:return r=s.sent,s.abrupt("return",Z(r));case 14:case"end":return s.stop()}}),null,this)}}]),t}(r.a.Component),se=function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(k.a,null,r.a.createElement(x.a,null,r.a.createElement(y.a,null,r.a.createElement("h1",null,"Multitool"),r.a.createElement("h2",null,"Create multisignatures transactions using Ledger Nano S"))),r.a.createElement(x.a,null,r.a.createElement(y.a,{className:""}),r.a.createElement(y.a,{className:"col-4"},r.a.createElement(c.b,{to:"/create",className:"btn btn-lg btn-block btn-primary"},"Create new transaction")),r.a.createElement(y.a,{className:""}),r.a.createElement(y.a,{className:"col-4"},"\xa0"),r.a.createElement(y.a,{className:""})))}}]),t}(r.a.Component);var ie=b.Encoding.toHex,oe=function(e){var t=e.index,n=e.chainId,a=e.signature,s=e.noneStatus,i=g.bnsCodec.identityToAddress({chainId:n,pubkey:a.pubkey});return r.a.createElement("li",{className:"list-group-item last-child-no-bottom-margin",key:ie(a.pubkey.data)},r.a.createElement("h5",null,"#".concat(t+1)," ",function(e,t){if(e.length<=t)return e;var n=Math.ceil((t-"\u2026".length)/2),a=Math.floor((t-"\u2026".length)/2);return e.slice(0,n)+"\u2026"+e.slice(-a)}(i,22)),r.a.createElement("p",{className:"text-muted text-break"},Z(a)),s&&s.error&&r.a.createElement(w.a,{variant:"warning"},"Nonce outdated. In signature: ",s.error.received,"; Expected: ",s.error.expected))},ce=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).interval=void 0,n.state={nonceStatuses:e.signatures.map((function(e){return{}}))},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=function(){var t;return N.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,N.a.awrap(Promise.all(e.props.signatures.map((function(t){var n;return N.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,N.a.awrap(q(e.props.chainId,t.pubkey));case 2:if(n=a.sent,t.nonce!==n){a.next=7;break}return a.abrupt("return",{});case 7:return a.abrupt("return",{error:{expected:n,received:t.nonce}});case 8:case"end":return a.stop()}}))}))));case 3:t=n.sent,e.setState({nonceStatuses:t}),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.warn(n.t0);case 10:case"end":return n.stop()}}),null,null,[[0,7]])};setTimeout(t,300),this.interval=setInterval(t,7e3)}},{key:"componentWillUnmount",value:function(){this.interval&&clearTimeout(this.interval),this.interval=void 0}},{key:"render",value:function(){var e=this;return r.a.createElement("ol",{className:"list-group mb-3"},this.props.signatures.map((function(t,n){return r.a.createElement(oe,{key:ie(t.signature),index:n,chainId:e.props.chainId,signature:t,noneStatus:e.state.nonceStatuses[n]})})))}}]),t}(r.a.Component),le=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={transaction:null,signatures:[],localSignature:"",posting:!1},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){if(!this.state.transaction){var e=window.location.href.match(/\/status\/([-_=a-zA-Z0-9]+)/);if(e&&e.length>=2)try{var t=ee(e[1]),n=t.transaction,a=t.primarySignature,r=t.otherSignatures;this.setState({transaction:n,signatures:[a].concat(Object(H.a)(r))})}catch(s){console.warn("Full error message",s),this.setState({globalError:"Error in URL: "+M(s)})}else this.setState({globalError:"Error in URL: Transaction missing"})}}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,null,r.a.createElement(x.a,null,r.a.createElement(y.a,null,r.a.createElement(S,{error:this.state.globalError}))),r.a.createElement(x.a,null,r.a.createElement(y.a,null,r.a.createElement("h2",null,"Signing link"),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"signingLink"},"Send this link to every user supposed to sign this transaction"),r.a.createElement("input",{className:"form-control",id:"signingLink",value:this.state.transaction?te(this.state.transaction,!0):"",readOnly:!0})))),r.a.createElement(x.a,null,r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h2",null,"Review transaction"),this.state.transaction&&r.a.createElement(O,{transaction:this.state.transaction})),r.a.createElement(y.a,{className:"col-6"},r.a.createElement("h2",null,"Signatures"),this.state.transaction&&r.a.createElement(ce,{chainId:this.state.transaction.creator.chainId,signatures:this.state.signatures}),r.a.createElement("p",null,r.a.createElement("button",{className:"btn btn-primary btn-sm",onClick:function(t){t.preventDefault(),e.addSignature()}},"Add signature")),r.a.createElement(S,{error:this.state.addSignatureError}),r.a.createElement("h2",null,"Post to blockchain"),r.a.createElement("div",{hidden:!!this.state.postSuccess},r.a.createElement("p",null,"The transaction with all signatures from above will be posted to the IOV blockchain."),r.a.createElement("p",null,r.a.createElement("button",{className:"btn btn-primary",disabled:this.state.posting,onClick:function(t){t.preventDefault(),e.postToChain()}},"Post now"))),r.a.createElement(w.a,{variant:"success",hidden:!this.state.postSuccess},r.a.createElement("p",null,"Sucessfully posted transaction with ID ",this.state.postSuccess," to the blockchain.")),r.a.createElement(S,{error:this.state.postError}))),r.a.createElement(x.a,null,r.a.createElement(y.a,null,"\xa0")))}},{key:"addSignature",value:function(){var e,t,n;return N.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(this.state.transaction){a.next=2;break}throw new Error("Original transaction not set");case 2:if(this.setState({addSignatureError:void 0}),null!==(e=prompt("Please enter signature"))){a.next=6;break}return a.abrupt("return");case 6:return a.prev=6,t=G(e),a.next=10,N.a.awrap(Y(this.state.transaction,t));case 10:if(a.sent){a.next=12;break}throw new Error("Signature is not valid for this transaction");case 12:if(!this.state.signatures.map((function(e){return e.signature})).find((function(e){return B(e,t.signature)}))){a.next=15;break}throw new Error("This signature is already included");case 15:n=this.state.signatures.filter((function(e){return!B(e.pubkey.data,t.pubkey.data)})),this.setState({signatures:[].concat(Object(H.a)(n),[t])}),a.next=23;break;case 19:a.prev=19,a.t0=a.catch(6),console.info("Full error message",a.t0),this.setState({addSignatureError:M(a.t0)});case 23:case"end":return a.stop()}}),null,this,[[6,19]])}},{key:"postToChain",value:function(){var e=this;if(!this.state.transaction)throw new Error("Original transaction not set");var t=function(e,t){var n=t.find((function(){return!0}));if(!n)throw new Error("First signature missing");return{transaction:e,primarySignature:n,otherSignatures:t.slice(1)}}(this.state.transaction,this.state.signatures);this.setState({posting:!0,postError:void 0}),function(e){var t,n,a,r;return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,N.a.awrap(j(e.transaction.creator.chainId));case 2:return t=s.sent,s.next=5,N.a.awrap(t.establishConnection());case 5:return n=s.sent,s.next=8,N.a.awrap(n.postTx(g.bnsCodec.bytesToPost(e)));case 8:return a=s.sent,s.next=11,N.a.awrap(a.blockInfo.waitFor((function(e){return!Object(f.isBlockInfoPending)(e)})));case 11:if(r=s.sent,!Object(f.isBlockInfoPending)(r)){s.next=14;break}throw new Error("Block info still pending. This is a bug");case 14:if(!Object(f.isBlockInfoFailed)(r)){s.next=16;break}throw new Error("Error posting transaction: ".concat(r.message));case 16:return s.abrupt("return",a.transactionId);case 17:case"end":return s.stop()}}))}(t).then((function(t){console.log("Successfully posted",t),e.setState({posting:!1,postError:void 0,postSuccess:t})}),(function(t){console.info("Full error message",t),e.setState({posting:!1,postError:M(t)})}))}}]),t}(r.a.Component);i.a.render(r.a.createElement(c.a,null,r.a.createElement(o.d,null,r.a.createElement(o.b,{exact:!0,path:"/create",component:ae}),r.a.createElement(o.b,{path:"/status",component:le}),r.a.createElement(o.b,{path:"/sign",component:re}),r.a.createElement(o.b,{path:"/",component:se}))),document.getElementById("root"))}},[[179,1,2]]]);
//# sourceMappingURL=main.f65fdef0.chunk.js.map